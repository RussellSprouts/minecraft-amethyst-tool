'use strict';function aa(a,b,c){return new ca(a.j,a.buffer,a.byteOffset+b,c)}
var ca=class extends DataView{constructor(a,b,c,d){super(b,c,d);this.j=a}getFloat32(a,b=this.j){return super.getFloat32(a,b)}getFloat64(a,b=this.j){return super.getFloat64(a,b)}getInt16(a,b=this.j){return super.getInt16(a,b)}getInt32(a,b=this.j){return super.getInt32(a,b)}getUint16(a,b=this.j){return super.getUint16(a,b)}getUint32(a,b=this.j){return super.getUint32(a,b)}setFloat32(a,b,c=this.j){super.setFloat32(a,b,c)}setFloat64(a,b,c=this.j){super.setFloat64(a,b,c)}setInt16(a,b,c=this.j){super.setInt16(a,
b,c)}setInt32(a,b,c=this.j){super.setInt32(a,b,c)}setUint16(a,b,c=this.j){super.setUint16(a,b,c)}setUint32(a,b,c=this.j){super.setUint32(a,b,c)}getBigInt64(a,b=this.j){return super.getBigInt64(a,b)}getBigUint64(a,b=this.j){return super.getBigInt64(a,b)}setBigInt64(a,b,c=this.j){super.setBigInt64(a,b,c)}setBigUint64(a,b,c=this.j){super.setBigUint64(a,b,c)}};const ha=new TextDecoder("utf-8"),ia=new TextEncoder;function ja(a){a.j+=1;return a.data.getInt8(a.j-1)}function ka(a){a.j+=4;return a.data.getInt32(a.j-4)}function ra(a){const b=a.data.getUint16(a.j);a.j+=2;var c=a.data;c=0===b?"":ha.decode(new DataView(c.buffer,c.byteOffset+a.j,b));a.j+=b;return c}function sa(a,b){const c=ka(a);b=aa(a.data,a.j,c*b);a.j+=b.byteLength;return b}function ta(a){const b=a.data.getUint16(a.j);a.j+=2+b}function ya(a,b){const c=ka(a);a.j+=c*b}
var Aa=class{constructor(a){this.data=a;this.j=0}};function Ba(a){throw Error(`Unexpected case: ${a}`);}function Ca(a,b,c){return new Promise((d,e)=>{function f(){for(;l<a.length&&h<b.max;){const v=l;l++;const u=a[v];h++;c(u,v,a).then(r=>{g[v]=r}).catch(r=>{e(r)}).finally(()=>{h--;f()})}l===a.length&&0===h&&d(g)}const g=Array(a.length);let h=0,l=0;f()})};function Da(a,b){return"*"===a?"*":Array.isArray(a)?a[0]:a["*"]?a["*"]:a[b]??"*"}function Ea(a,b,c){if(!a)throw Error(`${b}\n${c}`);}
function Fa(a,b,c,d,e){switch(c){case 0:break;case 1:return Ga(d,"byte",e),ja(b);case 2:return Ga(d,"short",e),b.j+=2,b.data.getInt16(b.j-2);case 3:return Ga(d,"int",e),ka(b);case 4:return Ga(d,"long",e),b.j+=8,b.data.getBigInt64(b.j-8);case 5:return Ga(d,"float",e),b.j+=4,b.data.getFloat32(b.j-4);case 6:return Ga(d,"double",e),b.j+=8,b.data.getFloat64(b.j-8);case 8:return Ga(d,"string",e),ra(b);case 7:return Ga(d,"byteArray",e),sa(b,1);case 11:return Ga(d,"intArray",e),sa(b,4);case 12:return Ga(d,
"longArray",e),sa(b,8);case 10:Ha(d,e);c={};for(var f;0!==(f=ja(b));){var g=ra(b);"*"===d||d["*"]||g in d?c[g]=Fa(a,b,f,Da(d,g),`${e}.${g}`):Ia(a,b,f)}return c;case 9:Ea("*"===d||Array.isArray(d),`Found ${d}, but expected a list`,e);c=ja(b);f=ka(b);g=[];for(let h=0;h<f;h++)g.push(Fa(a,b,c,Da(d,0),`${e}[${h}]`));return g;default:(0,Ba)(c)}}function Ga(a,b,c){Ea("*"===a||a===b,`Found a ${b}, but expected ${a}`,c)}
function Ha(a,b){Ea("*"===a||!Array.isArray(a)&&"object"===typeof a,`Found ${a}, but expected a compound.`,b)}function Ia(a,b,c){switch(c){case 0:break;case 1:b.j+=1;break;case 2:b.j+=2;break;case 3:b.j+=4;break;case 4:b.j+=8;break;case 5:b.j+=4;break;case 6:b.j+=8;break;case 8:ta(b);break;case 7:ya(b,1);break;case 11:ya(b,4);break;case 12:ya(b,8);break;case 10:for(;0!==(c=ja(b));)ta(b),Ia(a,b,c);break;case 9:c=ja(b);const d=ka(b);for(let e=0;e<d;e++)Ia(a,b,c);break;default:(0,Ba)(c)}}
var Ja=class{constructor(a){this.j=a}parse(a,b=!1){a=new ca(b,a.buffer,a.byteOffset,a.byteLength);a=new Aa(a);Ea(10===ja(a),"Expected a compound at root");ra(a);return Fa(this,a,10,this.j,"root")}};function t(a,b,c){return`${a}:${b}:${c}`};function Ka(a,b,c,d){const e=8>=b?new Uint8Array(c):new Uint16Array(c);for(let u=0;u<c;u++){var f=u;{var g=a;var h=(1<<b)-1;var l=u*b+Math.floor(u/Math.floor(64/b))*(d?0:64%b);const r=8*Math.floor(l/64);l%=64;if(32>l){var v=g.getUint32(r+4);g=g.getUint32(r);h=(v>>>l|g<<31-l<<1)&h}else v=g.getUint32(r),g=r+8<g.byteLength?g.getUint32(r+12):0,h=(v>>>l-32|g<<63-l<<1)&h}e[f]=h}return e};var La=pako;async function Na(a){return La.ungzip(a)};function Oa(a){return null!=a.Properties&&Object.keys(a.Properties).length?`${a.Name}[${Object.keys(a.Properties).sort().map(b=>`${b}=${a.Properties[b]}`).join(",")}]`:`${a.Name}`};function Pa(a){return new Promise((b,c)=>{const d=new FileReader;d.addEventListener("load",()=>{b(new Uint8Array(d.result))});d.addEventListener("error",()=>{c(d.error)});d.addEventListener("abort",()=>{c(Error("load aborted"))});d.readAsArrayBuffer(a)})}async function Qa(a){return"string"===typeof a?(a=await (await fetch(a)).arrayBuffer(),new Uint8Array(a)):Pa(a)};const Ra=new Map,Sa=new Map,Ta=new Map;let Ua=0;function Ya(a,b,c){const d=(...e)=>{const f=new EventTarget;return{promise:new Promise(g=>{Sa.set(Ua,g);Ta.set(Ua,l=>{f.dispatchEvent(new CustomEvent("progress",{detail:l}))});g=a[Math.floor(Math.random()*a.length)];const h=Ra.get(g);if(!h)throw Error(`Couldn't find worker named ${g}`);console.log("making remote call",b,Ua,e,a,g);h.postMessage({event:b,id:Ua,U:e});Ua++}),progress:f}};d.V=c;d.event=b;return d};async function*Za(a){if(0!==a.input.byteLength)for(let c=0;32>c;c++)for(let d=0;32>d;d++){var b=a.input.getUint32(4*((c&31)+32*(d&31)));b=0>=(b&255)?-1:4096*(b>>8);if(0>b)continue;const e=a.input.getUint32(b),f=a.input.getUint8(b+4);2!==f&&console.warn("Unexpected compression type",f);b=new Uint8Array(a.input.buffer,b+5,e-1);b=await (0,Na)(b);b=(new Ja($a)).parse(b);yield new ab(b)}}async function*bb(a){for await(const b of Za(a))yield*b.j}var cb=class{constructor(a){this.input=a}};
const db={Y:"byte",block_states:{data:"longArray",palette:[{Name:"string",Properties:{"*":"string"}}]},BlockStates:"longArray",Palette:[{Name:"string",Properties:{"*":"string"}}]},eb={MOTION_BLOCKING:"longArray",MOTION_BLOCKING_NO_LEAVES:"longArray",OCEAN_FLOOR:"longArray",OCEAN_FLOOR_WG:"longArray",WORLD_SURFACE:"longArray",WORLD_SURFACE_WG:"longArray"},$a={DataVersion:"int",sections:[db],xPos:"int",zPos:"int",Heightmaps:eb,Level:{xPos:"int",zPos:"int",Status:"string",Sections:[db],Heightmaps:eb}};
class ab{constructor(a){this.data=a;this.B={};this.j=(this.data?.["sections"]??this.data?.["Level"]?.["Sections"]??[]).map(b=>{b=new fb(this,this.u,b);return this.B[b.y]=b})}get u(){return this.data.DataVersion}get m(){return this.data.xPos??this.data.Level?.["xPos"]}get o(){return this.data.zPos??this.data.Level?.["zPos"]}}function gb(a,b,c,d){!a.m&&a.u&&(a.m=(0,Ka)(a.u,a.C,4096,2529>a.B));return a.m?a.j[a.m[(b&15)+16*(d&15)+256*(c&15)]]:"minecraft:air"}
class fb{constructor(a,b,c){this.o=a;this.B=b;this.j=(c.block_states?.["palette"]??c.Palette??[{Name:"minecraft:air",Properties:{}}]).map(Oa);this.y=c.Y??0;this.u=c.block_states?.["data"]??c.BlockStates;this.C=Math.max(Math.ceil(Math.log2(this.j.length)),4)}};var hb=(0,Ya)(["general"],"regions",async(a,b)=>{const c=Date.now();console.log("START",c);let d=0;await (0,Ca)(Array.from(b),{max:8},async e=>{e=await (0,Pa)(e);var f=new cb(new DataView(e.buffer));e=new Set;for await(const g of bb(f))if(g.j.indexOf("minecraft:budding_amethyst"))for(f=0;16>f;f++)for(let h=0;16>h;h++)for(let l=0;16>l;l++)"minecraft:budding_amethyst"===gb(g,l,f,h)&&e.add((0,t)(16*g.o.m+l,16*g.y+f,16*g.o.o+h));console.log("BUDDING",e.size,e);d++;a.progress(100*d/b.length)});a.progress(100);
console.log("END",Date.now()-c)});var ib=(0,Ya)(["general"],"budding_chunks",async(a,b)=>{a={};b=await (0,Qa)(b);b=new cb(new DataView(b.buffer));for await(const c of Za(b)){b=0;let d=!1;for(const e of c.j){d=!0;const f=e.j.indexOf("minecraft:budding_amethyst");if(-1!==f){gb(e,0,0,0);for(const g of e.m??[])g===f&&b++}}d&&(a[(0,t)(c.m,0,c.o)]=b)}return a});var jb=(0,Ya)(["general"],"getPattern",async(a,b)=>{a=new Map;for(let d=0;d<b;d++)for(let e=0;e<b;e++){var c=[];for(let f=-8;8>=f;f++)for(let g=-8;8>=g;g++){const h=d/b-(g+.5),l=e/b-(f+.5);c.push(64>h*h+l*l?"1":"0")}c=BigInt(`0b${c.reverse().join("")}`);a.has(c)?a.get(c).push({x:d,z:e}):a.set(c,[{x:d,z:e}])}return a});
//# sourceMappingURL=root.js.map
