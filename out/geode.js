'use strict';function Zc(a,b){var c=a.G[b];return c?c??0:(c=a.D.length,a.D[c]=b,a.G[b]=c)}function $c(a){const b=a.canvas.width/2,c=a.canvas.height/2;return{left:a.m-b,right:a.m+b+a.j,top:a.o-c,bottom:a.o+c+a.j}}function ad(a){try{if(a.B&&(a.m+=.1*-a.m,a.o+=.1*-a.o,1>Math.abs(a.m)&&1>Math.abs(a.o)&&(a.B=!1)),a.u||a.B)a.render(),a.u=!1}finally{requestAnimationFrame(()=>ad(a))}}function bd(a,b,c){b=Math.floor(b/32);c=Math.floor(c/32);c=(0,t)(b,0,c);return(b=a.I[c])?b:a.I[c]=new Uint16Array(1024)}
function cd(a,b,c,d){bd(a,b,c)[(b%32+32)%32+(c%32+32)%32*32]=Zc(a,d)}function dd(a,b,c){const d=bd(a,b,c);return d?a.D[d[(b%32+32)%32+(c%32+32)%32*32]]??a.C:a.C}
var ed=class{constructor(){this.C="#999";this.I={};this.G={};this.D=[];this.o=this.m=0;this.j=16;this.u=this.B=!1;this.canvas=(0,w)(document.querySelector("#map"),HTMLCanvasElement);this.context=(0,w)(this.canvas.getContext("2d"),CanvasRenderingContext2D);Zc(this,this.C);const a=this.canvas.getBoundingClientRect();this.canvas.width=a.right-a.left;this.canvas.height=a.bottom-a.top;this.canvas.addEventListener("mousemove",b=>{1===b.buttons&&(this.B=!1,this.m-=b.movementX,this.o-=b.movementY,console.log(b.movementX,
b.movementY),this.u=!0)},{passive:!0});this.canvas.addEventListener("wheel",b=>{b.preventDefault();this.B=!1;var c=$c(this);const d=this.canvas.getBoundingClientRect(),e=(c.left+b.clientX-d.left)/this.j;c=(c.top+b.clientY-d.top)/this.j;this.j-=Math.sign(b.deltaY);4>this.j&&(this.j=4);const f=$c(this),g=(f.top+b.clientY-d.top)/this.j;this.m+=this.j*(e-(f.left+b.clientX-d.left)/this.j);this.o+=this.j*(c-g);this.u=!0});requestAnimationFrame(()=>ad(this))}render(){this.context.fillStyle=this.C;this.context.fillRect(0,
0,this.canvas.width,this.canvas.height);const {left:a,right:b,top:c,bottom:d}=$c(this);for(let e=c;e<d;e+=this.j)for(let f=a;f<b;f+=this.j){const g=Math.floor(f/this.j),h=Math.floor(e/this.j);this.context.fillStyle=dd(this,g,h);this.context.fillRect(Math.floor(g*this.j-a),Math.floor(h*this.j-c),this.j,this.j)}}addEventListener(a,b){this.canvas.addEventListener(a,c=>{const {left:d,top:e}=$c(this),f=this.canvas.getBoundingClientRect();b(Math.floor((d+(c.clientX-f.left))/this.j),Math.floor((e+(c.clientY-
f.top))/this.j))},{passive:!0})}};(0,rb)("general");(0,vc)();(0,function(){for(const a of document.getElementsByClassName("file-select")){const b=(0,w)(a.querySelector("span"),HTMLSpanElement),c=(0,w)(a.querySelector("input"),HTMLInputElement),d=b.textContent;c.addEventListener("change",()=>{c.files&&0!==c.files.length?b.textContent=1===c.files.length?"1 file selected.":`${c.files.length} files selected.`:b.textContent=d})}})();const fd={},gd={};
function hd(a){return(a=a.match(/.*r\.(-?[0-9]+)\.(-?[0-9]+)\.mca$/))?{x:parseInt(a[1]),z:parseInt(a[2])}:{x:Infinity,z:Infinity}}const id=(0,w)(document.getElementById("afk-spot-log"),HTMLElement),jd=(0,w)(document.getElementById("region-files"),HTMLInputElement);
jd.addEventListener("change",async()=>{function a(...l){console.log(...l);l=l.map(q=>q?q.toString():"");id.textContent=l.join("\t")+"\n"}function b(l,q,z){const y=(0,t)(l,0,q);fd[y]=(fd[y]??0)+z;"purple"!==dd(h,l,q)&&(z=Math.floor(256*(1-fd[y]/1E3)),z=0>z?"#000000":16>z?`0${z.toString(16)}`:z.toString(16),cd(h,l,q,`#${z}${z}${z}`));fd[y]>v&&(v=fd[y],k=16*l,x=16*q,console.log(`New best ${y} ${v}`))}var c=(0,w)(document.getElementById("step-1-response"),HTMLDivElement),d=(0,w)(document.getElementById("step-1-response-balloon"),
HTMLDivElement),e=(0,w)(document.getElementById("step-2"),HTMLDivElement);c.classList.add("hidden");e.classList.add("hidden");id.textContent="";const f=Array.from(jd.files??[]);if(0!==f.length){d.textContent=`Selected ${f.length} files.`;c.classList.remove("hidden");e.classList.remove("hidden");var g=(0,w)(document.getElementById("map-label"),HTMLDivElement),h=new ed;h.addEventListener("mousemove",(l,q)=>{g.textContent=`x:${16*l} z:${16*q} afk:${fd[(0,t)(l,0,q)]??"??"} chunk:${gd[(0,t)(l,0,q)]??"??"}`});
f.sort((l,q)=>{l=hd(l.name);q=hd(q.name);return l.x*l.x+l.z*l.z-(q.x*q.x+q.z*q.z)});var k=0,x=0,v=-1;a(`Processing ${f.length} region files...`);c=0;for(const l of f){a(`Processing ${l.name} (${Math.floor(c/f.length*100)}% overall)\nAFK at x:${k} z:${x} to have ${v} budding amethyst in range.`);c++;try{if(0===l.size){a("  (Skipping empty region)");continue}l.name.endsWith(".mca")||a("  (Skipping unknown file type)");const q=await (0,gb)(l).promise;Object.assign(gd,q);for(const [z,y]of Object.entries(q)){const [C,
,G]=(0,ib)(z);0<y?cd(h,C,G,"purple"):dd(h,C,G)===h.C&&cd(h,C,G,"aliceblue");h.u=!0;if(0<y)for(d=-8;8>=d;d++)for(e=-8;8>=e;e++){const I=e+.5,m=d+.5;64>I*I+m*m&&b(C+e,G+d,y)}}}catch(q){a("Error:",q),console.log(q)}}a(`Processing finished (100% overall).\nAFK at x:${k} z:${x} to have ${v} budding amethyst in range.`)}});
//# sourceMappingURL=geode.js.map
