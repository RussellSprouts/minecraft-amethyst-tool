'use strict';function aa(a,b,c){return new da(a.j,a.buffer,a.byteOffset+b,c)}
var da=class extends DataView{constructor(a,b,c,d){super(b,c,d);this.j=a}getFloat32(a,b=this.j){return super.getFloat32(a,b)}getFloat64(a,b=this.j){return super.getFloat64(a,b)}getInt16(a,b=this.j){return super.getInt16(a,b)}getInt32(a,b=this.j){return super.getInt32(a,b)}getUint16(a,b=this.j){return super.getUint16(a,b)}getUint32(a,b=this.j){return super.getUint32(a,b)}setFloat32(a,b,c=this.j){super.setFloat32(a,b,c)}setFloat64(a,b,c=this.j){super.setFloat64(a,b,c)}setInt16(a,b,c=this.j){super.setInt16(a,
b,c)}setInt32(a,b,c=this.j){super.setInt32(a,b,c)}setUint16(a,b,c=this.j){super.setUint16(a,b,c)}setUint32(a,b,c=this.j){super.setUint32(a,b,c)}getBigInt64(a,b=this.j){return super.getBigInt64(a,b)}getBigUint64(a,b=this.j){return super.getBigInt64(a,b)}setBigInt64(a,b,c=this.j){super.setBigInt64(a,b,c)}setBigUint64(a,b,c=this.j){super.setBigUint64(a,b,c)}};const fa=new TextDecoder("utf-8"),ka=new TextEncoder;function la(a){a.j+=1;return a.data.getInt8(a.j-1)}function ma(a){a.j+=4;return a.data.getInt32(a.j-4)}function na(a){const b=a.data.getUint16(a.j);a.j+=2;var c=a.data;c=0===b?"":fa.decode(new DataView(c.buffer,c.byteOffset+a.j,b));a.j+=b;return c}function ra(a,b){const c=ma(a);b=aa(a.data,a.j,c*b);a.j+=b.byteLength;return b}function sa(a){const b=a.data.getUint16(a.j);a.j+=2+b}function xa(a,b){const c=ma(a);a.j+=c*b}
var za=class{constructor(a){this.data=a;this.j=0}};function Aa(a){throw Error(`Unexpected case: ${a}`);}function Ba(a,b,c){return new Promise((d,e)=>{function f(){for(;k<a.length&&h<b.max;){const x=k;k++;const v=a[x];h++;c(v,x,a).then(l=>{g[x]=l}).catch(l=>{e(l)}).finally(()=>{h--;f()})}k===a.length&&0===h&&d(g)}const g=Array(a.length);let h=0,k=0;f()})};function Ca(a,b){return"*"===a?"*":Array.isArray(a)?a[0]:a["*"]?a["*"]:a[b]??"*"}function Da(a,b,c){if(!a)throw Error(`${b}\n${c}`);}
function Ea(a,b,c,d,e){switch(c){case 0:break;case 1:return Fa(d,"byte",e),la(b);case 2:return Fa(d,"short",e),b.j+=2,b.data.getInt16(b.j-2);case 3:return Fa(d,"int",e),ma(b);case 4:return Fa(d,"long",e),b.j+=8,b.data.getBigInt64(b.j-8);case 5:return Fa(d,"float",e),b.j+=4,b.data.getFloat32(b.j-4);case 6:return Fa(d,"double",e),b.j+=8,b.data.getFloat64(b.j-8);case 8:return Fa(d,"string",e),na(b);case 7:return Fa(d,"byteArray",e),ra(b,1);case 11:return Fa(d,"intArray",e),ra(b,4);case 12:return Fa(d,
"longArray",e),ra(b,8);case 10:Ga(d,e);c={};for(var f;0!==(f=la(b));){var g=na(b);"*"===d||d["*"]||g in d?c[g]=Ea(a,b,f,Ca(d,g),`${e}.${g}`):Ha(a,b,f)}return c;case 9:Da("*"===d||Array.isArray(d),`Found ${d}, but expected a list`,e);c=la(b);f=ma(b);g=[];for(let h=0;h<f;h++)g.push(Ea(a,b,c,Ca(d,0),`${e}[${h}]`));return g;default:(0,Aa)(c)}}function Fa(a,b,c){Da("*"===a||a===b,`Found a ${b}, but expected ${a}`,c)}
function Ga(a,b){Da("*"===a||!Array.isArray(a)&&"object"===typeof a,`Found ${a}, but expected a compound.`,b)}function Ha(a,b,c){switch(c){case 0:break;case 1:b.j+=1;break;case 2:b.j+=2;break;case 3:b.j+=4;break;case 4:b.j+=8;break;case 5:b.j+=4;break;case 6:b.j+=8;break;case 8:sa(b);break;case 7:xa(b,1);break;case 11:xa(b,4);break;case 12:xa(b,8);break;case 10:for(;0!==(c=la(b));)sa(b),Ha(a,b,c);break;case 9:c=la(b);const d=ma(b);for(let e=0;e<d;e++)Ha(a,b,c);break;default:(0,Aa)(c)}}
var Ia=class{constructor(a){this.j=a}parse(a,b=!1){a=new da(b,a.buffer,a.byteOffset,a.byteLength);a=new za(a);Da(10===la(a),"Expected a compound at root");na(a);return Ea(this,a,10,this.j,"root")}};function t(a,b,c){return`${a}:${b}:${c}`};function Ja(a,b,c,d){const e=8>=b?new Uint8Array(c):new Uint16Array(c);for(let v=0;v<c;v++){var f=v;{var g=a;var h=(1<<b)-1;var k=v*b+Math.floor(v/Math.floor(64/b))*(d?0:64%b);const l=8*Math.floor(k/64);k%=64;if(32>k){var x=g.getUint32(l+4);g=g.getUint32(l);h=(x>>>k|g<<31-k<<1)&h}else x=g.getUint32(l),g=l+8<g.byteLength?g.getUint32(l+12):0,h=(x>>>k-32|g<<63-k<<1)&h}e[f]=h}return e};var Ka=pako;async function Ma(a){return Ka.ungzip(a)};function Na(a){return null!=a.Properties&&Object.keys(a.Properties).length?`${a.Name}[${Object.keys(a.Properties).sort().map(b=>`${b}=${a.Properties[b]}`).join(",")}]`:`${a.Name}`};function Oa(a){return new Promise((b,c)=>{const d=new FileReader;d.addEventListener("load",()=>{b(new Uint8Array(d.result))});d.addEventListener("error",()=>{c(d.error)});d.addEventListener("abort",()=>{c(Error("load aborted"))});d.readAsArrayBuffer(a)})};async function*Pa(a){if(0!==a.j.byteLength)for(let c=0;32>c;c++)for(let d=0;32>d;d++){var b=a.j.getUint32(4*((c&31)+32*(d&31)));b=0>=(b&255)?-1:4096*(b>>8);if(0>b)continue;const e=a.j.getUint32(b),f=a.j.getUint8(b+4);2!==f&&console.warn("Unexpected compression type",f);b=new Uint8Array(a.j.buffer,b+5,e-1);b=await (0,Ma)(b);b=(new Ia(Qa)).parse(b);yield new Ra(b)}}async function*Sa(a){for await(const b of Pa(a))yield*b.j}var Wa=class{constructor(a){this.j=a}};
const Xa={Y:"byte",block_states:{data:"longArray",palette:[{Name:"string",Properties:{"*":"string"}}]},BlockStates:"longArray",Palette:[{Name:"string",Properties:{"*":"string"}}]},Ya={MOTION_BLOCKING:"longArray",MOTION_BLOCKING_NO_LEAVES:"longArray",OCEAN_FLOOR:"longArray",OCEAN_FLOOR_WG:"longArray",WORLD_SURFACE:"longArray",WORLD_SURFACE_WG:"longArray"},Qa={DataVersion:"int",sections:[Xa],xPos:"int",zPos:"int",Heightmaps:Ya,Level:{xPos:"int",zPos:"int",Status:"string",Sections:[Xa],Heightmaps:Ya}};
class Ra{constructor(a){this.data=a;this.B={};this.j=(this.data?.["sections"]??this.data?.["Level"]?.["Sections"]??[]).map(b=>{b=new Za(this,this.u,b);return this.B[b.y]=b})}get u(){return this.data.DataVersion}get m(){return this.data.xPos??this.data.Level?.["xPos"]}get o(){return this.data.zPos??this.data.Level?.["zPos"]}}function $a(a,b,c,d){!a.m&&a.u&&(a.m=(0,Ja)(a.u,a.C,4096,2529>a.B));return a.m?a.j[a.m[(b&15)+16*(d&15)+256*(c&15)]]:"minecraft:air"}
class Za{constructor(a,b,c){this.o=a;this.B=b;this.j=(c.block_states?.["palette"]??c.Palette??[{Name:"minecraft:air",Properties:{}}]).map(Na);this.y=c.Y??0;this.u=c.block_states?.["data"]??c.BlockStates;this.C=Math.max(Math.ceil(Math.log2(this.j.length)),4)}};const ab=new Map,bb=new Map,cb=new Map;let db=0;function eb(a,b,c){const d=(...e)=>{const f=new EventTarget;return{promise:new Promise(g=>{bb.set(db,g);cb.set(db,k=>{f.dispatchEvent(new CustomEvent("progress",{detail:k}))});g=a[Math.floor(Math.random()*a.length)];const h=ab.get(g);if(!h)throw Error(`Couldn't find worker named ${g}`);console.log("making remote call",b,db,e,a,g);h.postMessage({event:b,id:db,U:e});db++}),progress:f}};d.V=c;d.event=b;return d};var fb=(0,eb)(["general"],"regions",async(a,b)=>{const c=Date.now();console.log("START",c);let d=0;await (0,Ba)(Array.from(b),{max:8},async e=>{e=await (0,Oa)(e);var f=new Wa(new DataView(e.buffer));e=new Set;for await(const g of Sa(f))if(g.j.indexOf("minecraft:budding_amethyst"))for(f=0;16>f;f++)for(let h=0;16>h;h++)for(let k=0;16>k;k++)"minecraft:budding_amethyst"===$a(g,k,f,h)&&e.add((0,t)(16*g.o.m+k,16*g.y+f,16*g.o.o+h));console.log("BUDDING",e.size,e);d++;a.progress(100*d/b.length)});a.progress(100);
console.log("END",Date.now()-c)});var gb=(0,eb)(["general"],"budding_chunks",async(a,b)=>{a={};b=await (0,Oa)(b);b=new Wa(new DataView(b.buffer));for await(const c of Pa(b)){b=0;let d=!1;for(const e of c.j){d=!0;const f=e.j.indexOf("minecraft:budding_amethyst");if(-1!==f){$a(e,0,0,0);for(const g of e.m??[])g===f&&b++}}d&&(a[(0,t)(c.m,0,c.o)]=b)}return a});
//# sourceMappingURL=root.js.map
