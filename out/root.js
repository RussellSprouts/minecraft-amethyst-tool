'use strict';function ba(a,b,c){return new da(a.j,a.buffer,a.byteOffset+b,c)}
var da=class extends DataView{constructor(a,b,c,d){super(b,c,d);this.j=a}getFloat32(a,b=this.j){return super.getFloat32(a,b)}getFloat64(a,b=this.j){return super.getFloat64(a,b)}getInt16(a,b=this.j){return super.getInt16(a,b)}getInt32(a,b=this.j){return super.getInt32(a,b)}getUint16(a,b=this.j){return super.getUint16(a,b)}getUint32(a,b=this.j){return super.getUint32(a,b)}setFloat32(a,b,c=this.j){super.setFloat32(a,b,c)}setFloat64(a,b,c=this.j){super.setFloat64(a,b,c)}setInt16(a,b,c=this.j){super.setInt16(a,
b,c)}setInt32(a,b,c=this.j){super.setInt32(a,b,c)}setUint16(a,b,c=this.j){super.setUint16(a,b,c)}setUint32(a,b,c=this.j){super.setUint32(a,b,c)}getBigInt64(a,b=this.j){return super.getBigInt64(a,b)}getBigUint64(a,b=this.j){return super.getBigInt64(a,b)}setBigInt64(a,b,c=this.j){super.setBigInt64(a,b,c)}setBigUint64(a,b,c=this.j){super.setBigUint64(a,b,c)}};const ia=new TextDecoder("utf-8"),ja=new TextEncoder;function ka(a){a.j+=1;return a.data.getInt8(a.j-1)}function la(a){a.j+=4;return a.data.getInt32(a.j-4)}function sa(a){const b=a.data.getUint16(a.j);a.j+=2;var c=a.data;c=0===b?"":ia.decode(new DataView(c.buffer,c.byteOffset+a.j,b));a.j+=b;return c}function ta(a,b){const c=la(a);b=ba(a.data,a.j,c*b);a.j+=b.byteLength;return b}function ya(a){const b=a.data.getUint16(a.j);a.j+=2+b}function za(a,b){const c=la(a);a.j+=c*b}
var Aa=class{constructor(a){this.data=a;this.j=0}};function Ca(a){throw Error(`Unexpected case: ${a}`);}function Da(a,b,c){return new Promise((d,e)=>{function f(){for(;k<a.length&&h<b.max;){const y=k;k++;const v=a[y];h++;c(v,y,a).then(q=>{g[y]=q}).catch(q=>{e(q)}).finally(()=>{h--;f()})}k===a.length&&0===h&&d(g)}const g=Array(a.length);let h=0,k=0;f()})};function Ea(a,b){return"*"===a?"*":Array.isArray(a)?a[0]:a["*"]?a["*"]:a[b]??"*"}function Fa(a,b,c){if(!a)throw Error(`${b}\n${c}`);}
function Ga(a,b,c,d,e){switch(c){case 0:break;case 1:return Ha(d,"byte",e),ka(b);case 2:return Ha(d,"short",e),b.j+=2,b.data.getInt16(b.j-2);case 3:return Ha(d,"int",e),la(b);case 4:return Ha(d,"long",e),b.j+=8,b.data.getBigInt64(b.j-8);case 5:return Ha(d,"float",e),b.j+=4,b.data.getFloat32(b.j-4);case 6:return Ha(d,"double",e),b.j+=8,b.data.getFloat64(b.j-8);case 8:return Ha(d,"string",e),sa(b);case 7:return Ha(d,"byteArray",e),ta(b,1);case 11:return Ha(d,"intArray",e),ta(b,4);case 12:return Ha(d,
"longArray",e),ta(b,8);case 10:Ia(d,e);c={};for(var f;0!==(f=ka(b));){var g=sa(b);"*"===d||d["*"]||g in d?c[g]=Ga(a,b,f,Ea(d,g),`${e}.${g}`):Ja(a,b,f)}return c;case 9:Fa("*"===d||Array.isArray(d),`Found ${d}, but expected a list`,e);c=ka(b);f=la(b);g=[];for(let h=0;h<f;h++)g.push(Ga(a,b,c,Ea(d,0),`${e}[${h}]`));return g;default:(0,Ca)(c)}}function Ha(a,b,c){Fa("*"===a||a===b,`Found a ${b}, but expected ${a}`,c)}
function Ia(a,b){Fa("*"===a||!Array.isArray(a)&&"object"===typeof a,`Found ${a}, but expected a compound.`,b)}function Ja(a,b,c){switch(c){case 0:break;case 1:b.j+=1;break;case 2:b.j+=2;break;case 3:b.j+=4;break;case 4:b.j+=8;break;case 5:b.j+=4;break;case 6:b.j+=8;break;case 8:ya(b);break;case 7:za(b,1);break;case 11:za(b,4);break;case 12:za(b,8);break;case 10:for(;0!==(c=ka(b));)ya(b),Ja(a,b,c);break;case 9:c=ka(b);const d=la(b);for(let e=0;e<d;e++)Ja(a,b,c);break;default:(0,Ca)(c)}}
var Ka=class{constructor(a){this.j=a}parse(a,b=!1){a=new da(b,a.buffer,a.byteOffset,a.byteLength);a=new Aa(a);Fa(10===ka(a),"Expected a compound at root");sa(a);return Ga(this,a,10,this.j,"root")}};function r(a,b,c){return`${a}:${b}:${c}`};function La(a,b,c,d){const e=8>=b?new Uint8Array(c):new Uint16Array(c);for(let v=0;v<c;v++){var f=v;{var g=a;var h=(1<<b)-1;var k=v*b+Math.floor(v/Math.floor(64/b))*(d?0:64%b);const q=8*Math.floor(k/64);k%=64;if(32>k){var y=g.getUint32(q+4);g=g.getUint32(q);h=(y>>>k|g<<31-k<<1)&h}else y=g.getUint32(q),g=q+8<g.byteLength?g.getUint32(q+12):0,h=(y>>>k-32|g<<63-k<<1)&h}e[f]=h}return e};var Ma=pako;async function Na(a){return Ma.ungzip(a)};function Pa(a){return null!=a.Properties&&Object.keys(a.Properties).length?`${a.Name}[${Object.keys(a.Properties).sort().map(b=>`${b}=${a.Properties[b]}`).join(",")}]`:`${a.Name}`};function Qa(a){return new Promise((b,c)=>{const d=new FileReader;d.addEventListener("load",()=>{b(new Uint8Array(d.result))});d.addEventListener("error",()=>{c(d.error)});d.addEventListener("abort",()=>{c(Error("load aborted"))});d.readAsArrayBuffer(a)})}async function Ra(a){return"string"===typeof a?(a=await (await fetch(a)).arrayBuffer(),new Uint8Array(a)):Qa(a)};const Sa=new Map,Ta=new Map,Ua=new Map;let Va=0;function Wa(a,b,c){const d=(...e)=>{const f=new EventTarget;return{promise:new Promise(g=>{Ta.set(Va,g);Ua.set(Va,k=>{f.dispatchEvent(new CustomEvent("progress",{detail:k}))});g=a[Math.floor(Math.random()*a.length)];const h=Sa.get(g);if(!h)throw Error(`Couldn't find worker named ${g}`);console.log("making remote call",b,Va,e,a,g);h.postMessage({event:b,id:Va,U:e});Va++}),progress:f}};d.V=c;d.event=b;return d};async function*Xa(a){if(0!==a.input.byteLength)for(let c=0;32>c;c++)for(let d=0;32>d;d++){var b=a.input.getUint32(4*((c&31)+32*(d&31)));b=0>=(b&255)?-1:4096*(b>>8);if(0>b)continue;const e=a.input.getUint32(b),f=a.input.getUint8(b+4);2!==f&&console.warn("Unexpected compression type",f);b=new Uint8Array(a.input.buffer,b+5,e-1);b=await (0,Na)(b);b=(new Ka(ab)).parse(b);yield new bb(b)}}async function*cb(a){for await(const b of Xa(a))yield*b.j}var db=class{constructor(a){this.input=a}};
const eb={Y:"byte",block_states:{data:"longArray",palette:[{Name:"string",Properties:{"*":"string"}}]},BlockStates:"longArray",Palette:[{Name:"string",Properties:{"*":"string"}}]},fb={MOTION_BLOCKING:"longArray",MOTION_BLOCKING_NO_LEAVES:"longArray",OCEAN_FLOOR:"longArray",OCEAN_FLOOR_WG:"longArray",WORLD_SURFACE:"longArray",WORLD_SURFACE_WG:"longArray"},ab={DataVersion:"int",sections:[eb],xPos:"int",zPos:"int",Heightmaps:fb,Level:{xPos:"int",zPos:"int",Status:"string",Sections:[eb],Heightmaps:fb}};
class bb{constructor(a){this.data=a;this.B={};this.j=(this.data?.["sections"]??this.data?.["Level"]?.["Sections"]??[]).map(b=>{b=new gb(this,this.u,b);return this.B[b.y]=b})}get u(){return this.data.DataVersion}get m(){return this.data.xPos??this.data.Level?.["xPos"]}get o(){return this.data.zPos??this.data.Level?.["zPos"]}}function hb(a,b,c,d){!a.m&&a.u&&(a.m=(0,La)(a.u,a.C,4096,2529>a.B));return a.m?a.j[a.m[(b&15)+16*(d&15)+256*(c&15)]]:"minecraft:air"}
class gb{constructor(a,b,c){this.o=a;this.B=b;this.j=(c.block_states?.["palette"]??c.Palette??[{Name:"minecraft:air",Properties:{}}]).map(Pa);this.y=c.Y??0;this.u=c.block_states?.["data"]??c.BlockStates;this.C=Math.max(Math.ceil(Math.log2(this.j.length)),4)}};var ib=(0,Wa)(["general"],"regions",async(a,b)=>{const c=Date.now();console.log("START",c);let d=0;await (0,Da)(Array.from(b),{max:8},async e=>{e=await (0,Qa)(e);var f=new db(new DataView(e.buffer));e=new Set;for await(const g of cb(f))if(g.j.indexOf("minecraft:budding_amethyst"))for(f=0;16>f;f++)for(let h=0;16>h;h++)for(let k=0;16>k;k++)"minecraft:budding_amethyst"===hb(g,k,f,h)&&e.add((0,r)(16*g.o.m+k,16*g.y+f,16*g.o.o+h));console.log("BUDDING",e.size,e);d++;a.progress(100*d/b.length)});a.progress(100);
console.log("END",Date.now()-c)});var jb=(0,Wa)(["general"],"budding_chunks",async(a,b)=>{a={};b=await (0,Ra)(b);b=new db(new DataView(b.buffer));for await(const c of Xa(b)){b=0;let d=!1;for(const e of c.j){d=!0;const f=e.j.indexOf("minecraft:budding_amethyst");if(-1!==f){hb(e,0,0,0);for(const g of e.m??[])g===f&&b++}}d&&(a[(0,r)(c.m,0,c.o)]=b)}return a});
//# sourceMappingURL=root.js.map
