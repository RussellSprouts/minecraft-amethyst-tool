'use strict';function aa(a,b,c){return new ba(a.j,a.buffer,a.byteOffset+b,c)}
var ba=class extends DataView{constructor(a,b,c,d){super(b,c,d);this.j=a}getFloat32(a,b=this.j){return super.getFloat32(a,b)}getFloat64(a,b=this.j){return super.getFloat64(a,b)}getInt16(a,b=this.j){return super.getInt16(a,b)}getInt32(a,b=this.j){return super.getInt32(a,b)}getUint16(a,b=this.j){return super.getUint16(a,b)}getUint32(a,b=this.j){return super.getUint32(a,b)}setFloat32(a,b,c=this.j){super.setFloat32(a,b,c)}setFloat64(a,b,c=this.j){super.setFloat64(a,b,c)}setInt16(a,b,c=this.j){super.setInt16(a,
b,c)}setInt32(a,b,c=this.j){super.setInt32(a,b,c)}setUint16(a,b,c=this.j){super.setUint16(a,b,c)}setUint32(a,b,c=this.j){super.setUint32(a,b,c)}getBigInt64(a,b=this.j){return super.getBigInt64(a,b)}getBigUint64(a,b=this.j){return super.getBigInt64(a,b)}setBigInt64(a,b,c=this.j){super.setBigInt64(a,b,c)}setBigUint64(a,b,c=this.j){super.setBigUint64(a,b,c)}};const ca=new TextDecoder("utf-8"),fa=new TextEncoder;function ia(a){a.j+=1;return a.data.getInt8(a.j-1)}function oa(a){a.j+=4;return a.data.getInt32(a.j-4)}function ra(a){const b=a.data.getUint16(a.j);a.j+=2;var c=a.data;c=0===b?"":ca.decode(new DataView(c.buffer,c.byteOffset+a.j,b));a.j+=b;return c}function sa(a){const b=a.data.getUint16(a.j);a.j+=2+b}function ta(a,b){const c=oa(a);a.j+=c*b}
var ua=class{constructor(a){this.data=a;this.j=0}array(a){const b=oa(this);a=aa(this.data,this.j,b*a);this.j+=a.byteLength;return a}};function va(a){throw Error(`Unexpected case: ${a}`);}function xa(a,b,c){return new Promise((d,e)=>{function f(){for(;l<a.length&&h<b.max;){const p=l;l++;const r=a[p];h++;c(r,p,a).then(w=>{g[p]=w}).catch(w=>{e(w)}).finally(()=>{h--;f()})}l===a.length&&0===h&&d(g)}const g=Array(a.length);let h=0,l=0;f()})};function ya(a,b){return"*"===a?"*":Array.isArray(a)?a[0]:a["*"]?a["*"]:a[b]??"*"}function Aa(a,b,c){if(!a)throw Error(`${b}\n${c}`);}
function Ba(a,b,c,d,e){switch(c){case 0:break;case 1:return Da(d,"byte",e),ia(b);case 2:return Da(d,"short",e),b.j+=2,b.data.getInt16(b.j-2);case 3:return Da(d,"int",e),oa(b);case 4:return Da(d,"long",e),b.j+=8,b.data.getBigInt64(b.j-8);case 5:return Da(d,"float",e),b.j+=4,b.data.getFloat32(b.j-4);case 6:return Da(d,"double",e),b.j+=8,b.data.getFloat64(b.j-8);case 8:return Da(d,"string",e),ra(b);case 7:return Da(d,"byteArray",e),b.array(1);case 11:return Da(d,"intArray",e),b.array(4);case 12:return Da(d,
"longArray",e),b.array(8);case 10:Ha(d,e);c={};for(var f;0!==(f=ia(b));){var g=ra(b);"*"===d||d["*"]||g in d?c[g]=Ba(a,b,f,ya(d,g),`${e}.${g}`):Ia(a,b,f)}return c;case 9:Aa("*"===d||Array.isArray(d),`Found ${d}, but expected a list`,e);c=ia(b);f=oa(b);g=[];for(let h=0;h<f;h++)g.push(Ba(a,b,c,ya(d,0),`${e}[${h}]`));return g;default:(0,va)(c)}}function Da(a,b,c){Aa("*"===a||a===b,`Found a ${b}, but expected ${a}`,c)}
function Ha(a,b){Aa("*"===a||!Array.isArray(a)&&"object"===typeof a,`Found ${a}, but expected a compound.`,b)}function Ia(a,b,c){switch(c){case 0:break;case 1:b.j+=1;break;case 2:b.j+=2;break;case 3:b.j+=4;break;case 4:b.j+=8;break;case 5:b.j+=4;break;case 6:b.j+=8;break;case 8:sa(b);break;case 7:ta(b,1);break;case 11:ta(b,4);break;case 12:ta(b,8);break;case 10:for(;0!==(c=ia(b));)sa(b),Ia(a,b,c);break;case 9:c=ia(b);const d=oa(b);for(let e=0;e<d;e++)Ia(a,b,c);break;default:(0,va)(c)}}
var Ja=class{constructor(a){this.j=a}parse(a,b=!1){a=new ba(b,a.buffer,a.byteOffset,a.byteLength);a=new ua(a);Aa(10===ia(a),"Expected a compound at root");ra(a);return Ba(this,a,10,this.j,"root")}};function v(a,b,c){return`${a}:${b}:${c}`}function La(a){return a.split(":").map(b=>+b)};function Ma(a,b,c,d,e,f){if(a.D&&a.M===b&&a.O===c&&a.P===d)return a.D;const g=(0,v)(b,c,d),h=a.segments[g];if(h)return a.D=h,a.M=b,a.O=c,a.P=d,h;if(e)return e=f?new Uint16Array(a.j*a.o*a.m):new Uint8Array(a.j*a.o*a.m),a.segments[g]=a.D=e,a.M=b,a.O=c,a.P=d,e}
var Na=class{constructor(a=16,b=16,c=16){this.j=a;this.o=b;this.m=c;this.segments={};this.T=!1;this.L=!0;this.P=this.O=this.M=this.H=this.C=this.G=this.B=this.F=this.u=0;this.D=void 0;if(0===a||a&a-1)throw Error("xSize must be a power of two.");if(0===b||b&b-1)throw Error("ySize must be a power of two.");if(0===c||c&c-1)throw Error("zSize must be a power of two.");}get width(){return this.F-this.u+1}get height(){return this.G-this.B+1}get length(){return this.H-this.C+1}get(a,b,c){const d=Ma(this,
Math.floor(a/this.j),Math.floor(b/this.o),Math.floor(c/this.m),!1,!1);if(!d)return 0;a&=this.j-1;b&=this.o-1;c&=this.m-1;return d[a+this.j*(c+this.m*b)]}set(a,b,c,d){255<d&&(this.T=!0);var e=a,f=b,g=c;this.L?(this.F=this.u=e,this.G=this.B=f,this.H=this.C=g,this.L=!1):(this.F=Math.max(this.F,e),this.G=Math.max(this.G,f),this.H=Math.max(this.H,g),this.u=Math.min(this.u,e),this.B=Math.min(this.B,f),this.C=Math.min(this.C,g));f=Math.floor(a/this.j);g=Math.floor(b/this.o);const h=Math.floor(c/this.m);
e=Ma(this,f,g,h,!0,255<d);a&=this.j-1;b&=this.o-1;c&=this.m-1;255<d&&e instanceof Uint8Array&&(f=(0,v)(f,g,h),e=this.segments[f]=Uint16Array.from(e));e[a+this.j*(c+this.m*b)]=d}[Symbol.iterator](){return Object.entries(this.segments).map(([a,b])=>{const [c,d,e]=(0,La)(a);return[c*this.j,d*this.o,e*this.m,b]})[Symbol.iterator]()}},Oa=class{constructor(){this.canvas=new Na(16,16,16)}add(a,b,c){const d=Math.floor(b/8);let e=this.canvas.get(a,d,c);this.canvas.set(a,d,c,e|1<<(b&7))}has(a,b,c){return 1===
(this.canvas.get(a,Math.floor(b/8),c)>>>(b&7)&1)}[Symbol.iterator](){return this.canvas[Symbol.iterator]()}};function Pa(a,b,c,d){if(a.m&&a.o===b&&a.u===c)return a.m;const e=(0,v)(b,0,c);let f=a.j[e];if(!f)if(d)f=a.j[e]=new Uint8Array(32768);else return;a.m=f;a.o=b;a.u=c;return f}function Ra(a,b,c,d){return 1===(a[b+Math.floor(((c&15)+16*(d&15))/8)]>>>(c&7)&1)}
function Sa(a){const b=[];for(const [c,d]of Object.entries(a.j)){const [e,,f]=(0,La)(c);for(a=0;32>a;a++)for(let g=0;32>g;g++){const h=32*(g+32*a);let l=!1;for(let p=0;32>p;p++)if(0!==d[h+p]){l=!0;break}l&&b.push({array:d,offset:h,I:32*e+g,J:32*f+a})}}return b}
var Ta=class{constructor(){this.j={};this.u=this.o=0}add(a,b){var c=Math.floor(a/16);const d=Math.floor(b/16),e=Pa(this,Math.floor(c/32),Math.floor(d/32),!0);c=32*((c&31)+32*(d&31));b=(a&15)+16*(b&15);a=Math.floor(b/8);b=1<<(b&7);e[c+a]=e[c+a]&~b|b}has(a,b){const c=Math.floor(a/16),d=Math.floor(b/16),e=Pa(this,Math.floor(c/32),Math.floor(d/32),!1);return e?Ra(e,32*((c&31)+32*(d&31)),a,b):!1}radius(a,b,c){const d=[];for(let g=-a;g<=a;g++)for(let h=-a;h<=a;h++)if(h**2+g**2<a**2){var e=b+h,f=c+g;const l=
Pa(this,Math.floor(e/32),Math.floor(f/32),!1);if(l){e=32*((e&31)+32*(f&31));f=!1;for(let p=0;32>p;p++)if(0!==l[e+p]){f=!0;break}f&&d.push({array:l,offset:e,I:b+h,J:c+g})}}return d}};function Ua(a,b,c,d){const e=8>=b?new Uint8Array(c):new Uint16Array(c);for(let r=0;r<c;r++){var f=r;{var g=a;var h=(1<<b)-1;var l=r*b+Math.floor(r/Math.floor(64/b))*(d?0:64%b);const w=8*Math.floor(l/64);l%=64;if(32>l){var p=g.getUint32(w+4);g=g.getUint32(w);h=(p>>>l|g<<31-l<<1)&h}else p=g.getUint32(w),g=w+8<g.byteLength?g.getUint32(w+12):0,h=(p>>>l-32|g<<63-l<<1)&h}e[f]=h}return e};var Va=pako;async function Wa(a){return Va.ungzip(a)};function Xa(a){return null!=a.Properties&&Object.keys(a.Properties).length?`${a.Name}[${Object.keys(a.Properties).sort().map(b=>`${b}=${a.Properties[b]}`).join(",")}]`:`${a.Name}`};function Ya(a){return new Promise((b,c)=>{const d=new FileReader;d.addEventListener("load",()=>{b(new Uint8Array(d.result))});d.addEventListener("error",()=>{c(d.error)});d.addEventListener("abort",()=>{c(Error("load aborted"))});d.readAsArrayBuffer(a)})}async function Za(a){return"string"===typeof a?(a=await (await fetch(a)).arrayBuffer(),new Uint8Array(a)):Ya(a)}function $a(a){return(a=a.match(/.*r\.(-?[0-9]+)\.(-?[0-9]+)\.mca$/))?{x:parseInt(a[1]),z:parseInt(a[2])}:{x:Infinity,z:Infinity}}
function ab(a){return"string"===typeof a?a.replace(/^.*\/([^/]+)$/,"$1"):a.name}function bb(a){return a.sort((b,c)=>{b=$a(ab(b));c=$a(ab(c));const d=Math.max(Math.abs(b.x),Math.abs(b.z)),e=Math.max(Math.abs(c.x),Math.abs(c.z));return d!==e?d-e:Math.atan2(b.z,b.x)-Math.atan2(c.z,c.x)})};const cb=new Map,db=new Map,eb=new Map;let fb=0;function gb(a,b,c){const d=(...e)=>{const f=new EventTarget;return{promise:new Promise(g=>{db.set(fb,g);eb.set(fb,l=>{f.dispatchEvent(new CustomEvent("progress",{detail:l}))});g=a[Math.floor(Math.random()*a.length)];const h=cb.get(g);if(!h)throw Error(`Couldn't find worker named ${g}`);console.log("making remote call",b,fb,e,a,g);h.postMessage({event:b,id:fb,da:e});fb++}),progress:f}};d.ia=c;d.event=b;return d};async function*hb(a){if(0!==a.input.byteLength)for(let c=0;32>c;c++)for(let d=0;32>d;d++){var b=a.input.getUint32(4*((c&31)+32*(d&31)));b=0>=(b&255)?-1:4096*(b>>8);if(0>b)continue;const e=a.input.getUint32(b),f=a.input.getUint8(b+4);2!==f&&console.warn("Unexpected compression type",f);b=new Uint8Array(a.input.buffer,b+5,e-1);b=await (0,Wa)(b);b=(new Ja(ib)).parse(b);yield new jb(b)}}async function*kb(a){for await(const b of hb(a))yield*b.o}var lb=class{constructor(a){this.input=a}};
const mb={Y:"byte",block_states:{data:"longArray",palette:[{Name:"string",Properties:{"*":"string"}}]},biomes:{palette:["string"],data:"longArray"},BlockStates:"longArray",Palette:[{Name:"string",Properties:{"*":"string"}}]},nb={MOTION_BLOCKING:"longArray",MOTION_BLOCKING_NO_LEAVES:"longArray",OCEAN_FLOOR:"longArray",OCEAN_FLOOR_WG:"longArray",WORLD_SURFACE:"longArray",WORLD_SURFACE_WG:"longArray"},ib={DataVersion:"int",sections:[mb],xPos:"int",zPos:"int",Heightmaps:nb,Level:{xPos:"int",zPos:"int",
Status:"string",Sections:[mb],Heightmaps:nb}};class jb{constructor(a){this.data=a;this.B={};this.o=(this.data?.["sections"]??this.data?.["Level"]?.["Sections"]??[]).map(b=>{b=new ob(this,this.u,b);return this.B[b.y]=b})}get u(){return this.data.DataVersion}get j(){return this.data.xPos??this.data.Level?.["xPos"]}get m(){return this.data.zPos??this.data.Level?.["zPos"]}}
function pb(a,b,c,d){!a.o&&a.C&&(a.o=(0,Ua)(a.C,a.F,4096,2529>a.D));return a.o?a.m[a.o[(b&15)+16*(d&15)+256*(c&15)]]:"minecraft:air"}function qb(a,b,c,d){if(!a.u&&a.j){if(1===a.j.palette.length)return a.j.palette[0];a.u=(0,Ua)(a.j.data,Math.ceil(Math.log2(a.j.palette.length)),64,!1)}return a.u?a.j?.["palette"][a.u[(b&3)+4*(d&3)+16*(c&3)]]??"minecraft:the_void":"minecraft:the_void"}
class ob{constructor(a,b,c){this.B=a;this.D=b;this.m=(c.block_states?.["palette"]??c.Palette??[{Name:"minecraft:air",Properties:{}}]).map(Xa);this.y=c.Y??0;this.C=c.block_states?.["data"]??c.BlockStates;this.j=c.biomes;this.F=Math.max(Math.ceil(Math.log2(this.m.length)),4)}};var rb=(0,gb)(["general"],"regions",async(a,b)=>{const c=Date.now();console.log("START",c);let d=0;await (0,xa)(Array.from(b),{max:8},async e=>{e=await (0,Ya)(e);var f=new lb(new DataView(e.buffer));e=new Set;for await(const g of kb(f))if(g.m.indexOf("minecraft:budding_amethyst"))for(f=0;16>f;f++)for(let h=0;16>h;h++)for(let l=0;16>l;l++)"minecraft:budding_amethyst"===pb(g,l,f,h)&&e.add((0,v)(16*g.B.j+l,16*g.y+f,16*g.B.m+h));console.log("BUDDING",e.size,e);d++;a.progress(100*d/b.length)});a.progress(100);
console.log("END",Date.now()-c)});var sb=(0,gb)(["general"],"budding_chunks",async(a,b)=>{a={};b=await (0,Za)(b);b=new lb(new DataView(b.buffer));for await(const c of hb(b)){b=0;let d=!1;for(const e of c.o){d=!0;const f=e.m.indexOf("minecraft:budding_amethyst");if(-1!==f){pb(e,0,0,0);for(const g of e.o??[])g===f&&b++}}d&&(a[(0,v)(c.j,0,c.m)]=b)}return a});var tb=(0,gb)(["general"],"getPattern",async(a,b)=>{a=new Map;for(let d=0;d<b;d++)for(let e=0;e<b;e++){var c=[];for(let f=-8;8>=f;f++)for(let g=-8;8>=g;g++){const h=d/b-(g+.5),l=e/b-(f+.5);c.push(64>h*h+l*l?"1":"0")}c=BigInt(`0b${c.reverse().join("")}`);a.has(c)?a.get(c).push({x:d,z:e}):a.set(c,[{x:d,z:e}])}return a});let ub;var vb=new Promise(a=>{ub=a});function wb(a){a.j.push(Date.now());a.m.push(1);a.o+=1;if(1024===a.j.length){for(var b=0;b<a.j.length;b+=2){const c=a.j[b];a.m[b/2]=a.m[b]+a.m[b+1];a.j[b/2]=c}a.j.length=512;a.m.length=512}for(b=Date.now();5<a.j.length&&3E4<b-a.j[0];)a.j.shift(),a.m.shift()}function xb(a){if(5>a.j.length)return 0;const b=(Date.now()-a.j[0])/1E3;return a.m.reduce((c,d)=>c+d,0)/b}function yb(a,b){b-=a.o;a=xb(a);return b/a}var zb=class{constructor(){this.startTime=Date.now();this.j=[];this.m=[];this.o=0}};
function Ab(a){return 60>a?`${a.toFixed(1)}s`:3600>a?`${Math.floor(a/60)}m ${Math.floor(a%60)}s`:`${Math.floor(a/3600)}h ${Math.floor(a%3600/60)}m ${Math.floor(a%60)}s`};let Bb=!1;
var Cb=(0,gb)(["general"],"cancelWorldLoading",async()=>{Bb=!0}),Db=(0,gb)(["general"],"drownedAfk",async(a,b,c)=>{function d(Q){let O=0;for(let x=0;16>x;x+=4)for(let t=0;16>t;t+=4){var R=(16*Q.I+t)/4;const D=(16*Q.J+x)/4;R=(0,v)(R,0,D);J[R]>O&&(O=J[R])}return O}function e(Q){var O=p.radius(3,Q.I,Q.J);for(var R of O)if(!S.has(R.I,R.J)){S.add(R.I,R.J);O=64*R.I;var x=64*R.J;for(var t=0;4>t;t++)for(var D=0;4>D;D++){var L=O+16*D,P=x+16*t,V=!0,ja=!1,ka=!1;for(let la=0;4>la;la++)for(let pa=0;4>pa;pa++){const Ka=
L+4*pa,Ea=P+4*la;if(Ra(R.array,R.offset,4*D+pa,4*t+la)){let Fa=!0,Qa=!1,Ga=!1;for(let q=0;4>q;q++)for(let Y=0;4>Y;Y++){const da=Ka+Y,qa=Ea+q;let W=!0,ea=!1,K=!1;for(let T=-64;64>T;T++){f(b,da,T,qa);const wa=g.value,za=h.value,ha=l.value;w.has(wa,za,ha)?ja=Qa=K=!0:(V=Fa=W=!1,H.has(wa,za,ha)&&(ka=Ga=ea=!0))}!ea&&K&&X.add(da,qa);a.progress({type:"block",x:da,z:qa,ca:W,ka:K,qa:ea})}a.progress({type:"quart-block",x:Ka,z:Ea,Z:Fa&&Qa,aa:Qa,$:Ga})}else a.progress({type:"quart-block",x:Ka,z:Ea,Z:!1,aa:!1,
$:!1})}a.progress({type:"chunk-block",x:L,z:P,ea:V&&ja,ga:ja,fa:ka})}}R=new Uint32Array(4096);O=64*Q.I;Q=64*Q.J;for(var F of Sa(X))for(x=0;16>x;x++)for(t=0;16>t;t++)if(D=16*F.I+t,L=16*F.J+x,Ra(F.array,F.offset,t,x))for(P=0;64>P;P++)for(V=0;64>V;V++)ja=D-(O+V),ka=L-(Q+P),16384>ja*ja+ka*ka&&R[V+64*P]++;for(F=0;64>F;F++)for(x=0;64>x;x++)t=R[x+64*F],t>U&&(U=t,ma=O+x,na=Q+F);console.log("BEST",U,ma,na)}Bb=!1;const {getBiomeSourceQuart:f,biomeX:g,biomeY:h,biomeZ:l}=await vb,p=new Ta;var r=new Ta;const w=
new Oa,H=new Oa,J={};var C=0;let z=(0,v)(0,0,0);(0,bb)(c);const I=new zb;let y=0;a:for(const Q of c){a.progress({type:"message",message:`Loading world ${Math.floor(y/c.length*100)}% (phase 1/2):\n${(0,ab)(Q)}...\n${xb(I).toFixed(1)} chunks/s. ${(0,Ab)(yb(I,1024*c.length))} left.`});y++;var k=new DataView((await (0,Za)(Q)).buffer);k=new lb(k);for await(const O of hb(k)){if(Bb)break a;let R=k=!1;for(const x of O.o)for(var m=0;4>m;m++)for(var n=0;4>n;n++)for(var B=0;4>B;B++){var u=4*O.j+B,G=4*x.y+m;
const t=4*O.m+n,D=qb(x,B,m,n);if("minecraft:river"===D)k=!0,w.add(u,G,t),p.add(u,t),p.add(u-1,t),p.add(u-1,t-1),p.add(u,t-1),p.add(u+1,t-1),p.add(u+1,t),p.add(u+1,t+1),p.add(u,t+1),p.add(u-1,t+1);else if("minecraft:dripstone_caves"===D||"minecraft:lush_caves"===D||"deep_dark"===D)R=!0,H.add(u,G,t),r.add(u,t),r.add(u-1,t),r.add(u-1,t-1),r.add(u,t-1),r.add(u+1,t-1),r.add(u+1,t),r.add(u+1,t+1),r.add(u,t+1),r.add(u-1,t+1)}if(k)for(m=R?192:256,n=-8;8>=n;n++)for(B=-8;8>=B;B++)64>B*B+n*n&&(u=(0,v)(O.j+B,
0,O.m+n),G=(J[u]??0)+m,G>C&&(C=G,z=u),J[u]=G);a.progress({type:"chunk",x:16*O.j,z:16*O.m,X:k,W:k&&R});wb(I)}}a.progress({type:"estimates",ha:J,la:C,ma:z});c=Sa(p);c.sort((Q,O)=>d(O)-d(Q));const S=new Ta,X=new Ta;let U=0,ma=0,na=0;for(;c.length;){r=c.shift();C=d(r);if(C<U){a.progress({type:"message",message:`Complete.\nCandidate ${C} is too small.\nBest found: ${U} @ x:${ma} z:${na}`});break}a.progress({type:"message",message:`Evaluating x:${64*r.I} z:${64*r.J}\nUp to: ${C}\nBest found: ${U} @ x:${ma} z:${na}`});
e(r)}});
//# sourceMappingURL=root.js.map
